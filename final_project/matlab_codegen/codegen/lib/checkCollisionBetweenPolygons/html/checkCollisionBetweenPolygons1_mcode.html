<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T9U3">bCollide</span> = checkCollisionBetweenPolygons( <span class="var type1" id="S3T1U6">P1</span>,<span class="var type1" id="S4T1U7">P2</span> ) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Returns a boolean indicating whether two arbitrary polygons collide.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% Requires to polygons defined as n-by-2 arrays of counterclockwise points.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% Function first tests whether any vertices of one polygon are inside the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% other, then checks for intersection of segments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% Intro to Robotics, ME170A/ECE181A, Spring 2009</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% Joey Durham</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">% April 21, 2009</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T7:U4"><span class="var type1" id="S5T7U10">tolerance</span> = <span class="mxinfo" id="T7:U6">0.001</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T9:U7"><span class="var type1" id="S2T9U14">bCollide</span> = <span class="mxinfo" id="T9:U9">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">% First, check if any vertex of P1 is inside P2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="var type1" id="S7T18U19">in2</span> = <span class="mxinfo" id="T18:U12"><span class="fcn" id="F215N3:B21">myinpolygon</span>( <span class="mxinfo" id="T2:U13"><span class="var type1" id="S3T1U23">P1</span>(:,<span class="mxinfo" id="T7:U15">1</span>)</span>, <span class="mxinfo" id="T2:U16"><span class="var type1" id="S3T1U27">P1</span>(:,<span class="mxinfo" id="T7:U18">2</span>)</span>, <span class="mxinfo" id="T2:U19"><span class="var type1" id="S4T1U31">P2</span>(:,<span class="mxinfo" id="T7:U21">1</span>)</span>, <span class="mxinfo" id="T2:U22"><span class="var type1" id="S4T1U35">P2</span>(:,<span class="mxinfo" id="T7:U24">2</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="keyword">if</span>( <span class="mxinfo" id="T9:U25">any(<span class="var type1" id="S7T18U43">in2</span>)</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="comment">%fprintf('Vertices in polygon\n');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo" id="T9:U27"><span class="var type1" id="S2T9U46">bCollide</span> = <span class="mxinfo" id="T9:U29">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="comment">% Next, check if any vertex of P2 is inside P1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T18:U30"><span class="var type1" id="S11T18U52">in1</span> = <span class="mxinfo" id="T18:U32"><span class="fcn" id="F215N3:B54">myinpolygon</span>( <span class="mxinfo" id="T2:U33"><span class="var type1" id="S4T1U56">P2</span>(:,<span class="mxinfo" id="T7:U35">1</span>)</span>, <span class="mxinfo" id="T2:U36"><span class="var type1" id="S4T1U60">P2</span>(:,<span class="mxinfo" id="T7:U38">2</span>)</span>, <span class="mxinfo" id="T2:U39"><span class="var type1" id="S3T1U64">P1</span>(:,<span class="mxinfo" id="T7:U41">1</span>)</span>, <span class="mxinfo" id="T2:U42"><span class="var type1" id="S3T1U68">P1</span>(:,<span class="mxinfo" id="T7:U44">2</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="keyword">if</span>( <span class="mxinfo" id="T9:U45">any(<span class="var type1" id="S11T18U76">in1</span>)</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo" id="T9:U47"><span class="var type1" id="S2T9U79">bCollide</span> = <span class="mxinfo" id="T9:U49">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="comment">% Finally, loop over all combinations of edges of segments checking for</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="comment">% intersection.  s1 and s2 are the endpoints of the ith segment of P1, while t1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="comment">% and t2 are for the jth segment of P2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S12T7U85">i</span> = <span class="mxinfo" id="T7:U51">1</span>:size(<span class="var type1" id="S3T1U90">P1</span>,1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T10:U53"><span class="var type1" id="S14T10U94">s1</span> = <span class="mxinfo" id="T10:U55"><span class="var type1" id="S3T1U96">P1</span>(<span class="mxinfo" id="T7:U57"><span class="mxinfo" id="T7:U58">1</span> + <span class="mxinfo" id="T7:U59">mod(<span class="mxinfo" id="T7:U60"><span class="var type1" id="S12T7U102">i</span>-<span class="mxinfo" id="T7:U62">1</span></span>,<span class="mxinfo" id="T7:U63">size(<span class="var type1" id="S3T1U106">P1</span>,1)</span>)</span></span>, :)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo" id="T10:U65"><span class="var type1" id="S16T10U111">s2</span> = <span class="mxinfo" id="T10:U67"><span class="var type1" id="S3T1U113">P1</span>(<span class="mxinfo" id="T7:U69"><span class="mxinfo" id="T7:U70">1</span> + <span class="mxinfo" id="T7:U71">mod(<span class="var type1" id="S12T7U118">i</span>,<span class="mxinfo" id="T7:U73">size(<span class="var type1" id="S3T1U121">P1</span>,1)</span>)</span></span>, :)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S17T7U126">j</span> = <span class="mxinfo" id="T7:U76">1</span>:size(<span class="var type1" id="S4T1U131">P2</span>,1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">        <span class="mxinfo" id="T10:U78"><span class="var type1" id="S18T10U135">t1</span> = <span class="mxinfo" id="T10:U80"><span class="var type1" id="S4T1U137">P2</span>(<span class="mxinfo" id="T7:U82"><span class="mxinfo" id="T7:U83">1</span> + <span class="mxinfo" id="T7:U84">mod(<span class="mxinfo" id="T7:U85"><span class="var type1" id="S17T7U143">j</span>-<span class="mxinfo" id="T7:U87">1</span></span>,<span class="mxinfo" id="T7:U88">size(<span class="var type1" id="S4T1U147">P2</span>,1)</span>)</span></span>, :)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">        <span class="mxinfo" id="T10:U90"><span class="var type1" id="S19T10U152">t2</span> = <span class="mxinfo" id="T10:U92"><span class="var type1" id="S4T1U154">P2</span>(<span class="mxinfo" id="T7:U94"><span class="mxinfo" id="T7:U95">1</span> + <span class="mxinfo" id="T7:U96">mod(<span class="var type1" id="S17T7U159">j</span>,<span class="mxinfo" id="T7:U98">size(<span class="var type1" id="S4T1U162">P2</span>,1)</span>)</span></span>, :)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">        <span class="mxinfo" id="T7:U100"><span class="var type1" id="S20T7U167">den</span> = <span class="mxinfo" id="T7:U102"><span class="mxinfo" id="T7:U103">(<span class="mxinfo" id="T7:U104"><span class="mxinfo" id="T7:U105"><span class="var type1" id="S19T10U173">t2</span>(<span class="mxinfo" id="T7:U107">2</span>)</span>-<span class="mxinfo" id="T7:U108"><span class="var type1" id="S18T10U176">t1</span>(<span class="mxinfo" id="T7:U110">2</span>)</span></span>)*(<span class="mxinfo" id="T7:U111"><span class="mxinfo" id="T7:U112"><span class="var type1" id="S16T10U181">s2</span>(<span class="mxinfo" id="T7:U114">1</span>)</span>-<span class="mxinfo" id="T7:U115"><span class="var type1" id="S14T10U184">s1</span>(<span class="mxinfo" id="T7:U117">1</span>)</span></span>)</span> - <span class="mxinfo" id="T7:U118">(<span class="mxinfo" id="T7:U119"><span class="mxinfo" id="T7:U120"><span class="var type1" id="S19T10U190">t2</span>(<span class="mxinfo" id="T7:U122">1</span>)</span>-<span class="mxinfo" id="T7:U123"><span class="var type1" id="S18T10U193">t1</span>(<span class="mxinfo" id="T7:U125">1</span>)</span></span>)*(<span class="mxinfo" id="T7:U126"><span class="mxinfo" id="T7:U127"><span class="var type1" id="S16T10U198">s2</span>(<span class="mxinfo" id="T7:U129">2</span>)</span>-<span class="mxinfo" id="T7:U130"><span class="var type1" id="S14T10U201">s1</span>(<span class="mxinfo" id="T7:U132">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">        <span class="mxinfo" id="T7:U133"><span class="var type1" id="S21T7U205">u_a</span> = <span class="mxinfo" id="T7:U135"><span class="mxinfo" id="T7:U136">(<span class="mxinfo" id="T7:U137"><span class="mxinfo" id="T7:U138"><span class="var type1" id="S19T10U211">t2</span>(<span class="mxinfo" id="T7:U140">1</span>)</span>-<span class="mxinfo" id="T7:U141"><span class="var type1" id="S18T10U214">t1</span>(<span class="mxinfo" id="T7:U143">1</span>)</span></span>)*(<span class="mxinfo" id="T7:U144"><span class="mxinfo" id="T7:U145"><span class="var type1" id="S14T10U219">s1</span>(<span class="mxinfo" id="T7:U147">2</span>)</span>-<span class="mxinfo" id="T7:U148"><span class="var type1" id="S18T10U222">t1</span>(<span class="mxinfo" id="T7:U150">2</span>)</span></span>)</span> - <span class="mxinfo" id="T7:U151">(<span class="mxinfo" id="T7:U152"><span class="mxinfo" id="T7:U153"><span class="var type1" id="S19T10U228">t2</span>(<span class="mxinfo" id="T7:U155">2</span>)</span>-<span class="mxinfo" id="T7:U156"><span class="var type1" id="S18T10U231">t1</span>(<span class="mxinfo" id="T7:U158">2</span>)</span></span>)*(<span class="mxinfo" id="T7:U159"><span class="mxinfo" id="T7:U160"><span class="var type1" id="S14T10U236">s1</span>(<span class="mxinfo" id="T7:U162">1</span>)</span>-<span class="mxinfo" id="T7:U163"><span class="var type1" id="S18T10U239">t1</span>(<span class="mxinfo" id="T7:U165">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">        <span class="keyword">if</span>( <span class="mxinfo" id="T9:U166"><span class="mxinfo" id="T7:U167">abs(<span class="var type1" id="S20T7U247">den</span>)</span> &lt; <span class="mxinfo" id="T7:U169"><span class="var type1" id="S5T7U248">tolerance</span></span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">            <span class="keyword">if</span>( <span class="mxinfo" id="T9:U171"><span class="mxinfo" id="T7:U172">abs(<span class="var type1" id="S21T7U255">u_a</span>)</span> &lt; <span class="mxinfo" id="T7:U174"><span class="var type1" id="S5T7U256">tolerance</span></span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">                <span class="comment">% Segments are coincident</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">                <span class="comment">%fprintf('Coincident segments\n');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">                <span class="mxinfo" id="T9:U176"><span class="var type1" id="S2T9U259">bCollide</span> = <span class="mxinfo" id="T9:U178">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">                <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">                <span class="comment">% Segments are parallel and cannot intersect</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">                <span class="keyword">continue</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">        <span class="mxinfo" id="T7:U179"><span class="var type1" id="S23T7U267">u_b</span> = <span class="mxinfo" id="T7:U181"><span class="mxinfo" id="T7:U182">(<span class="mxinfo" id="T7:U183"><span class="mxinfo" id="T7:U184"><span class="var type1" id="S16T10U273">s2</span>(<span class="mxinfo" id="T7:U186">1</span>)</span>-<span class="mxinfo" id="T7:U187"><span class="var type1" id="S14T10U276">s1</span>(<span class="mxinfo" id="T7:U189">1</span>)</span></span>)*(<span class="mxinfo" id="T7:U190"><span class="mxinfo" id="T7:U191"><span class="var type1" id="S14T10U281">s1</span>(<span class="mxinfo" id="T7:U193">2</span>)</span>-<span class="mxinfo" id="T7:U194"><span class="var type1" id="S18T10U284">t1</span>(<span class="mxinfo" id="T7:U196">2</span>)</span></span>)</span> - <span class="mxinfo" id="T7:U197">(<span class="mxinfo" id="T7:U198"><span class="mxinfo" id="T7:U199"><span class="var type1" id="S16T10U290">s2</span>(<span class="mxinfo" id="T7:U201">2</span>)</span>-<span class="mxinfo" id="T7:U202"><span class="var type1" id="S14T10U293">s1</span>(<span class="mxinfo" id="T7:U204">2</span>)</span></span>)*(<span class="mxinfo" id="T7:U205"><span class="mxinfo" id="T7:U206"><span class="var type1" id="S14T10U298">s1</span>(<span class="mxinfo" id="T7:U208">1</span>)</span>-<span class="mxinfo" id="T7:U209"><span class="var type1" id="S18T10U301">t1</span>(<span class="mxinfo" id="T7:U211">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">        <span class="mxinfo" id="T7:U212"><span class="var type1" id="S21T7U305">u_a</span> = <span class="mxinfo" id="T7:U214"><span class="var type1" id="S21T7U307">u_a</span> / <span class="var type1" id="S20T7U308">den</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">        <span class="mxinfo" id="T7:U217"><span class="var type1" id="S23T7U311">u_b</span> = <span class="mxinfo" id="T7:U219"><span class="var type1" id="S23T7U313">u_b</span> / <span class="var type1" id="S20T7U314">den</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line">        <span class="keyword">if</span>( <span class="mxinfo" id="T9:U222"><span class="var type1" id="S21T7U322">u_a</span> &gt;= <span class="mxinfo" id="T7:U224">0</span></span> &amp;&amp; <span class="mxinfo" id="T9:U225"><span class="var type1" id="S21T7U325">u_a</span> &lt;= <span class="mxinfo" id="T7:U227">1</span></span> &amp;&amp; <span class="mxinfo" id="T9:U228"><span class="var type1" id="S23T7U328">u_b</span> &gt;= <span class="mxinfo" id="T7:U230">0</span></span> &amp;&amp; <span class="mxinfo" id="T9:U231"><span class="var type1" id="S23T7U331">u_b</span> &lt;= <span class="mxinfo" id="T7:U233">1</span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line">            <span class="comment">% Segments intersect</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line">            <span class="comment">%fprintf('Intersecting segments\n');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line">            <span class="mxinfo" id="T9:U234"><span class="var type1" id="S2T9U335">bCollide</span> = <span class="mxinfo" id="T9:U236">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line">            <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
